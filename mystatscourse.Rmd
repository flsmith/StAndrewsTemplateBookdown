--- 
title: "An introduction to Statistical Modelling using GLMs"
author: "Lindesay Scott-Hayward"
date: '`r format(Sys.Date(), "%d %B %Y")`'
site: bookdown::bookdown_site
output: 
  bookdown::gitbook:
    lib_dir: "book_assets"
    config:
      sharing: null
      edit: null
    split_by: section
    highlight: tango
    css: 'style.css'
    includes:
      in_header: '_toggle.html'
  bookdown::pdf_book:
    keep_tex: true
    citation_package: natbib
    latex_engine: xelatex
    includes:
      in_header: preamble.tex
      after_body: afterbody.tex
documentclass: book
bibliography: [book.bib, packages.bib]
biblio-style: apalike
link-citations: yes
github-repo: lindesaysh/StatmodellingGitBook
description: "This is a minimal example of using the bookdown package to write a book. The output format for this example is bookdown::gitbook."
---

# Preface {-}

```{r, child = "_setup.Rmd", include = F, purl = F, cache = F}
```

An introductory -workshop to the field of statistical modelling in R. The focus will be on how to fit statistical models in R, rather than on the rigorous underlying mathematics. The target audience is anyone who wants to learn how to fit linear models in R. The progression will be linear models, generalised linear models and linear mixed effects models.

## Prerequisites {-}
* Programming basics in R

## Learning outcomes {-}

* Understand the key concepts and terminology used in statistical modelling
* Use R to fit linear, generalised linear and mixed effect models in R
* Recognise practical issues with fitting these models
* Checking model fit
* Perform model comparisons

## Recommended reading {-}

I highly recommend the following books:
* [Statistics: An Introduction using R](https://www.wiley.com/en-gb/Statistics%3A+An+Introduction+using+R-p-9780470022986)
* [Linear models with R](https://www.crcpress.com/Linear-Models-with-R/Faraway/p/book/9781439887332)
* [Data Analysis Using Regression and Multilevel/Hierarchical Models](http://www.stat.columbia.edu/~gelman/arm/)
* [An Introduction to Statistical Learning](http://www-bcf.usc.edu/~gareth/ISL/)
* [Mixed Effects Models and Extensions in Ecology with R](https://www.springer.com/gb/book/9780387874579)
* [Extending the Linear Model with R](https://www.amazon.co.uk/Extending-Linear-Model-Generalized-Nonparametric/dp/158488424X)

## Data files {-}

All data files can be downloaded as a ZIP file from [here](https://exeter-data-analytics.github.io/StatModelling/dataFiles.zip).

## Acknowledgements {-}


This is a _sample_ book written in **Markdown**. You can use anything that Pandoc's Markdown supports, e.g., a math equation $a^2 + b^2 = c^2$.


The **bookdown** package can be installed from CRAN or Github:

```{r eval=FALSE}
install.packages("bookdown")
# or the development version
# devtools::install_github("rstudio/bookdown")
```

Remember each Rmd file contains one and only one chapter, and a chapter is defined by the first-level heading `#`.

To compile this example to PDF, you need XeLaTeX. You are recommended to install TinyTeX (which includes XeLaTeX): <https://yihui.name/tinytex/>.

```{r include=FALSE}
# automatically create a bib database for R packages
knitr::write_bib(c(
  .packages(), 'bookdown', 'knitr', 'rmarkdown'
), 'packages.bib')
```

<!--chapter:end:index.Rmd-->

# Introduction {#intro}

You can label chapter and section titles using `{#label}` after them, e.g., we can reference Chapter \@ref(intro). If you do not manually label them, there will be automatic labels anyway, e.g., Chapter \@ref(methods).

## Figures and Tables

Figures and tables with captions will be placed in `figure` and `table` environments, respectively.

```{r nice-fig, fig.cap='Here is a nice figure!', out.width='80%', fig.asp=.75, fig.align='center'}
par(mar = c(4, 4, .1, .1))
plot(pressure, type = 'b', pch = 19)
```

Reference a figure by its code chunk label with the `fig:` prefix, e.g., see Figure \@ref(fig:nice-fig). Similarly, you can reference tables generated from `knitr::kable()`, e.g., see Table \@ref(tab:nice-tab).

You can also do a text reference for a figure which is useful if you want special characters;

(ref:myfig) Define a text reference **here** with some math symbols like $\theta$. 

```{r nice-fig2, fig.cap='(ref:myfig)', out.width='80%', fig.asp=.75, fig.align='center'}
par(mar = c(4, 4, .1, .1))
plot(pressure, type = 'b', pch = 19, col=2)
```

Here i am referencing \@ref(fig:nice-fig2).

```{r out.width='50%', fig.show='hold'}
par(mar = c(4, 4, .1, .1))
plot(pressure, pch = 19, type = 'b')
plot(cars, pch = 19)
```

```{r nice-tab, tidy=FALSE}
knitr::kable(
  head(iris, 20), caption = 'Here is a nice table!',
  booktabs = TRUE
)
```

Reference this table using Table \@ref(tab:nice-tab)

You can write citations, too. For example, we are using the **bookdown** package [@R-bookdown] in this sample book, which was built on top of R Markdown and **knitr** [@xie2015].

## Equations:

\begin{equation} 
  f\left(k\right) = \binom{n}{k} p^k\left(1-p\right)^{n-k}
  (\#eq:binom)
\end{equation} 

You may refer to it using \@ref(eq:binom), e.g., see Equation (2.1).

Please make sure equations \index{equations} without labels are not numbered by either using the equation* environment or adding \nonumber or \notag to your equations. The same rules apply to other math environments, such as eqnarray, gather, align, and so on (e.g., you can use the align* environment).

\begin{align} 
g(X_{n}) & = g(\theta)+g'({\tilde{\theta}})(X_{n}-\theta) \notag \\
\sqrt{n}[g(X_{n})-g(\theta)] & = g'\left({\tilde{\theta}}\right) 
\sqrt{n}[X_{n}-\theta](\#eq:align) \\
\end{align} 

use split to have multiple lines with one equation reference

\begin{equation} 
\begin{split}
\mathrm{Var}(\hat{\beta}) & =\mathrm{Var}((X'X)^{-1}X'y)\\
 & =(X'X)^{-1}X'\mathrm{Var}(y)((X'X)^{-1}X')'\\
 & =(X'X)^{-1}X'\mathrm{Var}(y)X(X'X)^{-1}\\
 & =(X'X)^{-1}X'\sigma^{2}IX(X'X)^{-1}\\
 & =(X'X)^{-1}\sigma^{2}
\end{split}
(\#eq:var-beta)
\end{equation} 

there are also 'example' and 'exercise' environments (labelled with exm and exr respectively)

```{example, eg1, name='how to do an example'}

for this example, we show nothing 

```



```{example, eg2, name='how to do a second example'}

for this example, we show something

```


These environments can be changed using the css file CSS class being the environment name, e.g., `<div class="lemma"></div>`


jgjhgjhgk

<!--chapter:end:01-intro.Rmd-->

# Literature

Here is a review of existing methods.

<!--chapter:end:02-literature.Rmd-->

# Methods

We describe our methods in this chapter.

We showed some examples in the introduction (Chapter \@ref(intro))

You can also reference specific sections by giving them a label `{#sectionname}`


And you can add words to the index such as GLM \index{GLM}

## Shiny app

### type 1 - calling from shinyapps.io

```{r myshiny, echo=FALSE, fig.cap='An eaxmple of a shiny app. you can see a live version at (put url here)', screenshot.opts = list(delay = 5)}
knitr::include_app("https://lindesaysh.shinyapps.io/mt1007_week22/", height='600px')
```


you can use a shiny app embedded in the notes Figure \@ref(fig:myshiny).

### type 3 - creating inline


<!-- ```{r eruptions, echo=FALSE} -->
<!-- selectInput( -->
<!--   'breaks', label = 'Number of bins:', -->
<!--   choices = c(10, 20, 35, 50), selected = 20 -->
<!-- ) -->

<!-- renderPlot({ -->
<!--   par(mar = c(4, 4, .1, .5)) -->
<!--   hist( -->
<!--     faithful$eruptions, as.numeric(input$breaks), -->
<!--     col = 'gray', border = 'white', -->
<!--     xlab = 'Duration (minutes)', main = '' -->
<!--   ) -->
<!-- }) -->
<!-- ``` -->

<!--chapter:end:03-method.Rmd-->

# Applications

```{r}
library(ggplot2)
```

Some _significant_ applications are demonstrated in this chapter.

## Example one



## Example two

> **Aside**: using the model to predict outside of the range of the observed data is called **extrapolating**. Oftentimes, statistical models are developed *in order* to be used to extrapolate (e.g. climate modelling). This is however, dangerous, as we can only assess the assumptions of the model over the range of the observed data. When extrapolating we have to assume that these relationships hold beyond the range of the data, which may or may not be reasonable (hence why weather forecast over short-time periods are OK, but climate forecasts are much more uncertain). Hence, we should always view the model as an approximation of the data generating process. In this particualr case, the interpretation of the parameters is not sensible when $x = 0$ (weight = 0 kg), but makes sense in the range that we are interested in exploring. If the case where $x = 0$ is important, then we would have to change the model to ensure that the predictions made sense at those values of $x$.



```{task}

Produce a scatterplot of `mpg` against `hp`. What does the relationship look like?

```

```{solution}

``{r}
plot(hp ~ mpg, data = mtcars, 
  pch=19, col='darkgrey')
``

This is my solution

```


```{task}

This is another task with multi solution

```


```{solution, multCode = T, cache = F}

``{r, fig.height=6, fig.width=6, out.width = "60%"}
plot(hp ~ mpg, data = mtcars,
     pch=19, col='darkgrey')
``

The plot suggests that a linear relationship might exist between the two variables. So we can proceed by fitting a linear model in R.

####

``{r, fig.height=6, fig.width=6}
ggplot(mtcars) +
    geom_point(aes(x = mpg, y = hp))
``

The plot suggests that a linear relationship might exist between the two variables. So we can proceed by fitting a linear model in R.

```


<!--chapter:end:04-application.Rmd-->

# Final Words

We have finished a nice book.

If you want to split the book by sections, so each html page is a section you can use split_by='section' in the YAML header. 

```
output: 
   bookdown::gitbook:
    lib_dir: "book_assets"
    config:
      sharing: null
    split_by: section
```


<!--chapter:end:05-summary.Rmd-->

`r if (knitr:::is_html_output()) '
# References {-}
'`

<!--chapter:end:07-references.Rmd-->

<!-- \newgeometry{margin=0.5in} -->

# (APPENDIX) Appendix {-}

# Answers

```{r, echo = F, results = "asis"}
for(i in 1:length(solLabels)) {
    if(!is.na(solLabels[[i]][2][1])) {
        taskCtr <- solLabels[[i]][1]
        refLabel <- solLabels[[i]][2]
        headerName <- solLabels[[i]][3]
        cat(paste0("\\hypertarget{sol", taskCtr, "}{}\n\\bblockS[", headerName, "]{\\phantomsection\\label{tsk", taskCtr, "}", taskCtr, "}\n"))
        cat(refLabel)
        cat(paste0("\n\n\\vspace{\\baselineskip}\\hyperlink{tsk", taskCtr, "}{\\buttonT{Return to task on P\\colpageref{sol", taskCtr, "}}}"))
        cat("\n\\eblockS\n")
    }
}
```

<!--chapter:end:ch_appendix.Rmd-->

